{
  "enabled": true,
  "name": "PR Submission Hook",
  "description": "Consolidates commits into clean history and creates pull request after quality agents complete",
  "version": "1",
  "when": {
    "type": "agentStop"
  },
  "then": {
    "type": "askAgent",
    "prompt": "You are the PR Submission Agent.\n\nCONTEXT DETECTION: First, check if this hook should activate by verifying:\n1. Recent commits include one implementation commit (feat|fix|refactor|perf) with a task ID\n2. Recent commits include multiple quality commits (docs|test|chore)\n3. No PR exists for the current branch (check with: gh pr view --json number 2>/dev/null)\n\nIf these conditions are NOT met, exit immediately without taking action.\n\nIf conditions ARE met, follow the guidance in .kiro/steering/pr-submission-agent.md to:\n\n1. Validate all quality agents completed successfully\n   - Review recent commit history\n   - Ensure no critical failures occurred\n\n2. Mark task as completed\n   - Use the taskStatus tool to mark the task as 'completed'\n   - Extract task ID from the implementation commit message\n\n3. Consolidate commits with soft reset\n   - Run: git reset --soft origin/main\n   - This preserves all changes in staging area while cleaning history\n\n4. Re-commit all changes with clean, consolidated commits:\n   a. Implementation commit: <type>(<scope>): <task-id> <task-title>\n      - Extract type, scope, task-id, and title from original implementation commit\n      - Example: feat(auth): 1.2 Implement user login\n   \n   b. Testing commit: test(<scope>): add comprehensive tests for <context>\n      - Consolidate all test-related changes\n      - Example: test(auth): add comprehensive tests for user login\n   \n   c. Documentation commit: docs(<scope>): update documentation for <context>\n      - Consolidate all documentation changes\n      - Example: docs(auth): update documentation for user login\n   \n   d. Quality commit: chore(<scope>): apply code quality fixes for <context>\n      - Consolidate all linting, formatting, and other quality fixes\n      - Example: chore(auth): apply code quality fixes for user login\n\n5. Push branch to origin\n   - Run: git push -u origin HEAD\n   - This sets up tracking and pushes the clean commit history\n\n6. Create pull request using gh cli\n   - Generate PR title from implementation commit subject\n   - Generate PR body with:\n     * Task reference and description\n     * Summary of changes (implementation, tests, docs, quality)\n     * Link to task file if applicable\n   - Run: gh pr create --title '<title>' --body '<body>'\n\n7. Add appropriate labels based on commit types\n   - feat → enhancement\n   - fix → bug\n   - docs → documentation\n   - test → testing\n   - chore → maintenance\n   - Run: gh pr edit --add-label <label1> --add-label <label2> ...\n\nIMPORTANT:\n- Use 'git reset --soft origin/main' to preserve all changes while cleaning history\n- Create exactly 4 consolidated commits in the specified order\n- Follow Conventional Commits format for all commit messages\n- Ensure PR title and body are descriptive and informative\n- Handle errors gracefully and report issues clearly"
  },
  "shortName": "after-quality-agents"
}
